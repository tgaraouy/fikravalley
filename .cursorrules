// .cursorrules - Place in project root
# Fikra Valley System Prompt

You are a Moroccan entrepreneurship AI orchestrator. Your mission is to transform spoken ideas (Darija/Tamazight/French/English) into structured, fundable projects via 7 specialized agents.

## Core Principles
- **Never** mention tool names (e.g., "I'll use the edit_file tool"). Just do the work.
- **Always** output JSON matching the exact Supabase schema field names.
- **Respect** Moroccan context: PDPL data law, 2G connectivity, diaspora funding.
- **Human-in-the-loop** is mandatory before any external action (mentor contact, public visibility).

## Project Structure
- `lib/agents/conversation-extractor-agent.ts` - Agent 1: Extracts from voice/text
- `app/api/agents/conversation-extractor/route.ts` - Agent 1 API endpoint
- `app/api/analyze-idea/route.ts` - Agent 2A/2B: Feasibility/Impact/ROI analysis
- `lib/idea-bank/scoring/two-stage-scorer.ts` - Agent 2C: SDG & Priority Alignment
- `lib/agents/mentor-agent.ts` - Agent 5: Mentor matching
- `lib/agents/notification-agent.ts` - Agent 6: Notification & sharing
- `lib/agents/feature-flag-agent.ts` - Agent 7: Feature flag & priority

## Key Schema Awareness
### marrai_ideas
id, title, problem_statement, proposed_solution, category, location, 
ai_feasibility_score, ai_impact_score, alignment (jsonb), status, visible, featured,
roi_time_saved_hours, roi_cost_saved_eur, estimated_cost, qualification_tier,
automation_potential, agent_type, human_in_loop

### marrai_conversation_ideas
speaker_quote, confidence_score, needs_clarification, validation_question, promoted_to_idea_id,
status (pending_validation|speaker_contacted|speaker_validated|promoted_to_idea),
speaker_phone (stored in speaker_context), speaker_email

### marrai_mentor_matches
mentor_id, match_score, status (pending|accepted|rejected|active|completed)

## Language Handling
- Input: Darija (Moroccan Arabic), Tamazight (Latin script), French, English
- Output: English for JSON keys, but preserve user content in original language
- Use "ÙˆÙ„ÙŠÙ†Ø§Ù‡Ø§ Ù…Ø´Ø±ÙˆØ¹" (let's make it a project) as transformation anchor phrase
# In your Cursor terminal:
cd marrai-idea-bank

# Create the file
touch .cursorrules

# Copy content from the .cursorrules file into it
```

Or just copy the file directly from the outputs folder.

### **Step 2: Test It** (1 minute)

1. Open any `.ts` file in Cursor
2. Press **Cmd+L** (or Ctrl+L)
3. Ask: `"What database tables should I use for this project?"`
4. Cursor should mention `marrai_ideas`, `marrai_workshop_sessions`, etc.

âœ… **Working? Perfect!**

### **Step 3: Start Using It** (immediately)

Every time you write code:

**Creating new API endpoint:**
```
Cmd+K â†’ "Create API endpoint for [feature] following project rules"
```

**Writing component:**
```
Cmd+K â†’ "Create component with French labels and loading states"
```

**Fixing error:**
```
Cmd+L â†’ "Fix this error: [paste error]. Check .cursorrules"
```

---

## ðŸ’¡ Key Rules Cursor Will Follow:

### **Database:**
- Always use `marrai_ideas` not `ideas`
- Never use reserved keywords like `current_role`
- Always include CASCADE on foreign keys

### **Code Quality:**
- Always wrap API routes in try-catch
- Always validate input
- Always handle loading states
- Always use French labels

### **Supabase Patterns:**
- Always use `.select()` with `.insert()`
- Always use `.single()` for unique records
- Always check for errors before using data
- Always unsubscribe from realtime channels

### **Claude API:**
- Always clean JSON response before parsing
- Always implement fallback analysis
- Always set reasonable token limits (2000-4000)

---

## ðŸ“Š Benefits You'll See:

### **Immediate (Day 1):**
- âœ… Cursor generates code that matches your patterns
- âœ… Fewer bugs from naming mistakes
- âœ… Consistent error handling everywhere

### **Short-term (Week 1):**
- âœ… 3x faster development (less copy-pasting patterns)
- âœ… Less time debugging common mistakes
- âœ… More confidence in AI-generated code

### **Long-term (Month 1):**
- âœ… Entire codebase follows same patterns
- âœ… Easy onboarding for new developers
- âœ… Cleaner, more maintainable code

---

## ðŸŽ¯ Example Workflow:

**You want to add a new feature: "Export ideas to CSV"**

### **Without `.cursorrules`:**
1. Create file manually
2. Look up Next.js API route structure
3. Look up Supabase query syntax
4. Remember table name is `marrai_ideas` not `ideas`
5. Add error handling
6. Add TypeScript types
7. Test everything
**Time: 30-45 minutes**

### **With `.cursorrules`:**
1. Create file: `app/api/export-csv/route.ts`
2. Press Cmd+K
3. Type: `"Create API endpoint that exports marrai_ideas to CSV following project patterns"`
4. Review generated code (already has error handling, correct table names, TypeScript types)
5. Test
**Time: 5-10 minutes**

**Cursor AI + Rules = 5x productivity boost** ðŸš€

---

## ðŸŽ“ Pro Tips:

### **1. Reference Rules Explicitly**
```
"Following .cursorrules, create..."
"According to project patterns..."
"Review this against .cursorrules"
```

### **2. Use @ Mentions**
```
"@.cursorrules What's the naming convention?"
"@lib/supabase.ts Show me query examples"

## Patterns I Discovered

### Workshop Dashboard Pattern
Always include:
- QR code for validation
- Real-time counter
- Notification sound on new ideas